import{_ as o,c as t,o as l,b as e,a as s,m as n}from"./chunks/framework.DUr976bL.js";const e1=JSON.parse('{"title":"GPT","description":"","frontmatter":{"title":"GPT","outline":"deep"},"headers":[{"level":2,"title":"架构：Decoder-only","slug":"架构-decoder-only","link":"#架构-decoder-only","children":[]},{"level":2,"title":"设计：MoE","slug":"设计-moe","link":"#设计-moe","children":[]},{"level":2,"title":"分词算法：BPE","slug":"分词算法-bpe","link":"#分词算法-bpe","children":[]},{"level":2,"title":"注意力机制：FlashAttention、稀疏注意力","slug":"注意力机制-flashattention、稀疏注意力","link":"#注意力机制-flashattention、稀疏注意力","children":[{"level":3,"title":"FlashAttention","slug":"flashattention","link":"#flashattention","children":[]},{"level":3,"title":"稀疏注意力","slug":"稀疏注意力","link":"#稀疏注意力","children":[]}]},{"level":2,"title":"位置编码：RoPE","slug":"位置编码-rope","link":"#位置编码-rope","children":[{"level":3,"title":"主要特点","slug":"主要特点","link":"#主要特点","children":[]},{"level":3,"title":"核心思想","slug":"核心思想","link":"#核心思想","children":[]},{"level":3,"title":"复数旋转","slug":"复数旋转","link":"#复数旋转","children":[]},{"level":3,"title":"模拟实现","slug":"模拟实现","link":"#模拟实现","children":[]},{"level":3,"title":"NTK RoPE(GPT-4)","slug":"ntk-rope-gpt-4","link":"#ntk-rope-gpt-4","children":[]}]},{"level":2,"title":"代码实现：PyTorch 简化版 GPT","slug":"代码实现-pytorch-简化版-gpt","link":"#代码实现-pytorch-简化版-gpt","children":[]}],"relativePath":"aiart/deep-learning/gpt.md","filePath":"aiart/deep-learning/gpt.md"}'),p={name:"aiart/deep-learning/gpt.md"},Q={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},T={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.464ex"},xmlns:"http://www.w3.org/2000/svg",width:"10.018ex",height:"1.959ex",role:"img",focusable:"false",viewBox:"0 -661 4428 866","aria-hidden":"true"},r={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},i={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.544ex",height:"1.974ex",role:"img",focusable:"false",viewBox:"0 -861.5 1124.6 872.5","aria-hidden":"true"},m={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},d={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.09ex"},xmlns:"http://www.w3.org/2000/svg",width:"6.76ex",height:"1.977ex",role:"img",focusable:"false",viewBox:"0 -833.9 2988.1 873.9","aria-hidden":"true"},c={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},y={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"10.104ex",height:"1.756ex",role:"img",focusable:"false",viewBox:"0 -694 4466 776","aria-hidden":"true"},h={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},E={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.023ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.197ex",height:"1.02ex",role:"img",focusable:"false",viewBox:"0 -441 529 451","aria-hidden":"true"},g={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},u={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"0.971ex",height:"1.595ex",role:"img",focusable:"false",viewBox:"0 -694 429 705","aria-hidden":"true"},b={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},H={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.023ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.061ex",height:"1.618ex",role:"img",focusable:"false",viewBox:"0 -705 469 715","aria-hidden":"true"},x={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},w={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.149ex"},xmlns:"http://www.w3.org/2000/svg",width:"23.967ex",height:"5.43ex",role:"img",focusable:"false",viewBox:"0 -1450 10593.6 2400","aria-hidden":"true"},F={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},f={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.576ex"},xmlns:"http://www.w3.org/2000/svg",width:"15.405ex",height:"2.466ex",role:"img",focusable:"false",viewBox:"0 -835.3 6808.9 1090.1","aria-hidden":"true"},k={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},M={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"6.11ex",height:"1.505ex",role:"img",focusable:"false",viewBox:"0 -583 2700.4 665","aria-hidden":"true"},L={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},V={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"18.166ex",height:"2.248ex",role:"img",focusable:"false",viewBox:"0 -911.5 8029.6 993.5","aria-hidden":"true"},Z={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},_={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.023ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.061ex",height:"1.618ex",role:"img",focusable:"false",viewBox:"0 -705 469 715","aria-hidden":"true"},v={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},B={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"69.23ex",height:"2.628ex",role:"img",focusable:"false",viewBox:"0 -911.5 30599.7 1161.5","aria-hidden":"true"},D={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},A={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.149ex"},xmlns:"http://www.w3.org/2000/svg",width:"10.7ex",height:"5.43ex",role:"img",focusable:"false",viewBox:"0 -1450 4729.4 2400","aria-hidden":"true"},P={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},C={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.17ex"},xmlns:"http://www.w3.org/2000/svg",width:"25.871ex",height:"5.47ex",role:"img",focusable:"false",viewBox:"0 -1459 11435.1 2418","aria-hidden":"true"},j={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},R={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.544ex",height:"1.974ex",role:"img",focusable:"false",viewBox:"0 -861.5 1124.6 872.5","aria-hidden":"true"},q={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},S={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.023ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.061ex",height:"1.618ex",role:"img",focusable:"false",viewBox:"0 -705 469 715","aria-hidden":"true"},N={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},z={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.576ex"},xmlns:"http://www.w3.org/2000/svg",width:"43.421ex",height:"2.843ex",role:"img",focusable:"false",viewBox:"0 -1002 19192.1 1256.8","aria-hidden":"true"},O={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},G={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"14.89ex",height:"2.446ex",role:"img",focusable:"false",viewBox:"0 -923.4 6581.4 1081.2","aria-hidden":"true"},I={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},J={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"15.236ex",height:"2.491ex",role:"img",focusable:"false",viewBox:"0 -943.3 6734.4 1101.1","aria-hidden":"true"},X={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},K={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"17.949ex",height:"2.491ex",role:"img",focusable:"false",viewBox:"0 -943.3 7933.6 1101.1","aria-hidden":"true"},U={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},$={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.09ex"},xmlns:"http://www.w3.org/2000/svg",width:"5.596ex",height:"1.597ex",role:"img",focusable:"false",viewBox:"0 -666 2473.6 706","aria-hidden":"true"};function W(Y,a,s1,a1,n1,t1){return l(),t("div",null,[a[85]||(a[85]=e("",36)),s("p",null,[a[4]||(a[4]=s("code",null,"RoPE",-1)),a[5]||(a[5]=n(" 灵感源于",-1)),a[6]||(a[6]=s("strong",null,"复数旋转",-1)),a[7]||(a[7]=n("。在复数空间中，一个向量 ",-1)),s("mjx-container",Q,[(l(),t("svg",T,a[0]||(a[0]=[e("",1)]))),a[1]||(a[1]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"z"),s("mo",null,"="),s("mi",null,"x"),s("mo",null,"+"),s("mi",null,"i"),s("mi",null,"y")])],-1))]),a[8]||(a[8]=n(" 可通过乘以 ",-1)),s("mjx-container",r,[(l(),t("svg",i,a[2]||(a[2]=[e("",1)]))),a[3]||(a[3]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("msup",null,[s("mi",null,"e"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i"),s("mi",null,"θ")])])])],-1))]),a[9]||(a[9]=n(" 进行旋转。",-1))]),a[86]||(a[86]=s("h3",{id:"复数旋转",tabindex:"-1"},[n("复数旋转 "),s("a",{class:"header-anchor",href:"#复数旋转","aria-label":'Permalink to "复数旋转"'},"​")],-1)),a[87]||(a[87]=s("p",null,[s("strong",null,"1. 复数表示向量")],-1)),s("p",null,[a[12]||(a[12]=n("在复数空间中，一个向量 ",-1)),s("mjx-container",m,[(l(),t("svg",d,a[10]||(a[10]=[e("",1)]))),a[11]||(a[11]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",{mathvariant:"bold"},"v")]),s("mo",null,"∈"),s("msup",null,[s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",{mathvariant:"double-struck"},"R")]),s("mn",null,"2")])])],-1))]),a[13]||(a[13]=n(" 可以表示为复数：",-1))]),s("mjx-container",c,[(l(),t("svg",y,a[14]||(a[14]=[e("",1)]))),a[15]||(a[15]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",{mathvariant:"bold"},"v")]),s("mo",null,"="),s("mi",null,"a"),s("mo",null,"+"),s("mi",null,"i"),s("mi",null,"b")])],-1))]),s("p",null,[s("mjx-container",h,[(l(),t("svg",E,a[16]||(a[16]=[s("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[s("g",{"data-mml-node":"math"},[s("g",{"data-mml-node":"mi"},[s("path",{"data-c":"1D44E",d:"M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z",style:{"stroke-width":"3"}})])])],-1)]))),a[17]||(a[17]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"a")])],-1))]),a[20]||(a[20]=n(" 是实部（对应向量横坐标），",-1)),s("mjx-container",g,[(l(),t("svg",u,a[18]||(a[18]=[s("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[s("g",{"data-mml-node":"math"},[s("g",{"data-mml-node":"mi"},[s("path",{"data-c":"1D44F",d:"M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z",style:{"stroke-width":"3"}})])])],-1)]))),a[19]||(a[19]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"b")])],-1))]),a[21]||(a[21]=n(" 是虚部（对应向量纵坐标）",-1))]),a[88]||(a[88]=s("p",null,[s("strong",null,"2. 旋转矩阵")],-1)),s("p",null,[a[24]||(a[24]=n("旋转矩阵是表示",-1)),a[25]||(a[25]=s("strong",null,"旋转操作",-1)),a[26]||(a[26]=n("的方阵，",-1)),a[27]||(a[27]=s("strong",null,"二维(2D)旋转",-1)),a[28]||(a[28]=n("矩阵绕原点旋转角度 ",-1)),s("mjx-container",b,[(l(),t("svg",H,a[22]||(a[22]=[s("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[s("g",{"data-mml-node":"math"},[s("g",{"data-mml-node":"mi"},[s("path",{"data-c":"1D703",d:"M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z",style:{"stroke-width":"3"}})])])],-1)]))),a[23]||(a[23]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"θ")])],-1))]),a[29]||(a[29]=n("（逆时针为正）：",-1))]),s("mjx-container",x,[(l(),t("svg",w,a[30]||(a[30]=[e("",1)]))),a[31]||(a[31]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("mi",null,"R"),s("mo",{stretchy:"false"},"("),s("mi",null,"θ"),s("mo",{stretchy:"false"},")"),s("mo",null,"="),s("mrow",{"data-mjx-texclass":"INNER"},[s("mo",{"data-mjx-texclass":"OPEN"},"("),s("mtable",{columnspacing:"1em",rowspacing:"4pt"},[s("mtr",null,[s("mtd",null,[s("mi",null,"cos"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mi",null,"θ")]),s("mtd",null,[s("mo",null,"−"),s("mi",null,"sin"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mi",null,"θ")])]),s("mtr",null,[s("mtd",null,[s("mi",null,"sin"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mi",null,"θ")]),s("mtd",null,[s("mi",null,"cos"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mi",null,"θ")])])]),s("mo",{"data-mjx-texclass":"CLOSE"},")")])])],-1))]),s("ul",null,[s("li",null,[a[36]||(a[36]=s("strong",null,"性质",-1)),a[37]||(a[37]=n("：",-1)),s("mjx-container",F,[(l(),t("svg",f,a[32]||(a[32]=[e("",1)]))),a[33]||(a[33]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("msubsup",null,[s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",{mathvariant:"bold"},"R")]),s("mi",null,"m"),s("mi",{mathvariant:"normal"},"⊤")]),s("msub",null,[s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",{mathvariant:"bold"},"R")]),s("mi",null,"n")]),s("mo",null,"="),s("msub",null,[s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",{mathvariant:"bold"},"R")]),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"n"),s("mo",null,"−"),s("mi",null,"m")])])])],-1))]),a[38]||(a[38]=n("。内积仅依赖相对位置 ",-1)),s("mjx-container",k,[(l(),t("svg",M,a[34]||(a[34]=[e("",1)]))),a[35]||(a[35]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"n"),s("mo",null,"−"),s("mi",null,"m")])],-1))]),a[39]||(a[39]=n("。",-1))])]),a[89]||(a[89]=s("p",null,[s("strong",null,"3. 欧拉公式：连接复数、指数函数和三角函数")],-1)),s("mjx-container",L,[(l(),t("svg",V,a[40]||(a[40]=[e("",1)]))),a[41]||(a[41]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("msup",null,[s("mi",null,"e"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i"),s("mi",null,"θ")])]),s("mo",null,"="),s("mi",null,"cos"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mi",null,"θ"),s("mo",null,"+"),s("mi",null,"i"),s("mi",null,"sin"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mi",null,"θ")])],-1))]),s("p",null,[a[44]||(a[44]=s("a",{href:"/aiart/deep-learning/mathematics.html#欧拉公式"},"欧拉公式",-1)),a[45]||(a[45]=n("表示的是一个 ",-1)),a[46]||(a[46]=s("strong",null,"单位复数",-1)),a[47]||(a[47]=n("（长度为 1），角度为 ",-1)),s("mjx-container",Z,[(l(),t("svg",_,a[42]||(a[42]=[s("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[s("g",{"data-mml-node":"math"},[s("g",{"data-mml-node":"mi"},[s("path",{"data-c":"1D703",d:"M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z",style:{"stroke-width":"3"}})])])],-1)]))),a[43]||(a[43]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"θ")])],-1))]),a[48]||(a[48]=n("。",-1))]),s("mjx-container",v,[(l(),t("svg",B,a[49]||(a[49]=[e("",1)]))),a[50]||(a[50]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("msup",null,[s("mi",null,"e"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i"),s("mi",null,"θ")])]),s("mo",null,"⋅"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",{mathvariant:"bold"},"v")]),s("mo",null,"="),s("mo",{stretchy:"false"},"("),s("mi",null,"a"),s("mo",null,"+"),s("mi",null,"i"),s("mi",null,"b"),s("mo",{stretchy:"false"},")"),s("mo",{stretchy:"false"},"("),s("mi",null,"cos"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mi",null,"θ"),s("mo",null,"+"),s("mi",null,"i"),s("mi",null,"sin"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mi",null,"θ"),s("mo",{stretchy:"false"},")"),s("mo",null,"="),s("mo",{stretchy:"false"},"("),s("mi",null,"a"),s("mi",null,"cos"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mi",null,"θ"),s("mo",null,"−"),s("mi",null,"b"),s("mi",null,"sin"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mi",null,"θ"),s("mo",{stretchy:"false"},")"),s("mo",null,"+"),s("mi",null,"i"),s("mo",{stretchy:"false"},"("),s("mi",null,"a"),s("mi",null,"sin"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mi",null,"θ"),s("mo",null,"+"),s("mi",null,"b"),s("mi",null,"cos"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mi",null,"θ"),s("mo",{stretchy:"false"},")")])],-1))]),s("p",null,[a[53]||(a[53]=n("这结果正好对应旋转后的向量 ",-1)),s("mjx-container",D,[(l(),t("svg",A,a[51]||(a[51]=[e("",1)]))),a[52]||(a[52]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"R"),s("mo",{stretchy:"false"},"("),s("mi",null,"θ"),s("mo",{stretchy:"false"},")"),s("mo",null,"⋅"),s("mrow",{"data-mjx-texclass":"INNER"},[s("mo",{"data-mjx-texclass":"OPEN"},"("),s("mtable",{columnspacing:"1em",rowspacing:"4pt"},[s("mtr",null,[s("mtd",null,[s("mi",null,"a")])]),s("mtr",null,[s("mtd",null,[s("mi",null,"b")])])]),s("mo",{"data-mjx-texclass":"CLOSE"},")")])])],-1))]),a[54]||(a[54]=n("，表示为：",-1))]),s("mjx-container",P,[(l(),t("svg",C,a[55]||(a[55]=[e("",1)]))),a[56]||(a[56]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("mrow",{"data-mjx-texclass":"INNER"},[s("mo",{"data-mjx-texclass":"OPEN"},"("),s("mtable",{columnspacing:"1em",rowspacing:"4pt"},[s("mtr",null,[s("mtd",null,[s("msup",null,[s("mi",null,"a"),s("mo",{"data-mjx-alternate":"1"},"′")])])]),s("mtr",null,[s("mtd",null,[s("msup",null,[s("mi",null,"b"),s("mo",{"data-mjx-alternate":"1"},"′")])])])]),s("mo",{"data-mjx-texclass":"CLOSE"},")")]),s("mo",null,"="),s("mrow",{"data-mjx-texclass":"INNER"},[s("mo",{"data-mjx-texclass":"OPEN"},"("),s("mtable",{columnspacing:"1em",rowspacing:"4pt"},[s("mtr",null,[s("mtd",null,[s("mi",null,"a"),s("mi",null,"cos"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mi",null,"θ"),s("mo",null,"−"),s("mi",null,"b"),s("mi",null,"sin"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mi",null,"θ")])]),s("mtr",null,[s("mtd",null,[s("mi",null,"a"),s("mi",null,"sin"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mi",null,"θ"),s("mo",null,"+"),s("mi",null,"b"),s("mi",null,"cos"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mi",null,"θ")])])]),s("mo",{"data-mjx-texclass":"CLOSE"},")")])])],-1))]),s("p",null,[a[63]||(a[63]=s("span",{style:{color:"#f00"}},[s("strong",null,"所以")],-1)),a[64]||(a[64]=n("：",-1)),s("strong",null,[a[61]||(a[61]=n("乘以 ",-1)),s("mjx-container",j,[(l(),t("svg",R,a[57]||(a[57]=[e("",1)]))),a[58]||(a[58]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("msup",null,[s("mi",null,"e"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i"),s("mi",null,"θ")])])])],-1))]),a[62]||(a[62]=n(" 等价于 旋转角度 ",-1)),s("mjx-container",q,[(l(),t("svg",S,a[59]||(a[59]=[s("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[s("g",{"data-mml-node":"math"},[s("g",{"data-mml-node":"mi"},[s("path",{"data-c":"1D703",d:"M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z",style:{"stroke-width":"3"}})])])],-1)]))),a[60]||(a[60]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"θ")])],-1))])]),a[65]||(a[65]=n("。",-1))]),a[90]||(a[90]=e("",5)),s("mjx-container",N,[(l(),t("svg",z,a[66]||(a[66]=[e("",1)]))),a[67]||(a[67]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("msubsup",null,[s("mrow",{"data-mjx-texclass":"ORD"},[s("mover",null,[s("mi",null,"q"),s("mo",{stretchy:"false"},"~")])]),s("mi",null,"m"),s("mi",{mathvariant:"normal"},"⊤")]),s("mo",null,"⋅"),s("msub",null,[s("mrow",{"data-mjx-texclass":"ORD"},[s("mover",null,[s("mi",null,"k"),s("mo",{stretchy:"false"},"~")])]),s("mi",null,"n")]),s("mo",null,"="),s("mo",{stretchy:"false"},"("),s("mi",null,"R"),s("mo",{stretchy:"false"},"("),s("mi",null,"m"),s("mo",{stretchy:"false"},")"),s("mi",null,"q"),s("msup",null,[s("mo",{stretchy:"false"},")"),s("mi",{mathvariant:"normal"},"⊤")]),s("mo",{stretchy:"false"},"("),s("mi",null,"R"),s("mo",{stretchy:"false"},"("),s("mi",null,"n"),s("mo",{stretchy:"false"},")"),s("mi",null,"k"),s("mo",{stretchy:"false"},")"),s("mo",null,"="),s("msup",null,[s("mi",null,"q"),s("mi",{mathvariant:"normal"},"⊤")]),s("mi",null,"R"),s("mo",{stretchy:"false"},"("),s("mi",null,"n"),s("mo",null,"−"),s("mi",null,"m"),s("mo",{stretchy:"false"},")"),s("mi",null,"k")])],-1))]),a[91]||(a[91]=e("",5)),s("ul",null,[s("li",null,[a[70]||(a[70]=n("原始的 RoPE 使用固定的频率 ",-1)),s("mjx-container",O,[(l(),t("svg",G,a[68]||(a[68]=[e("",1)]))),a[69]||(a[69]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("msub",null,[s("mi",null,"θ"),s("mi",null,"i")]),s("mo",null,"="),s("msup",null,[s("mn",null,"10000"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mo",null,"−"),s("mn",null,"2"),s("mi",null,"i"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mo",null,"/")]),s("mi",null,"d")])])])],-1))]),a[71]||(a[71]=n(" 做旋转；",-1))]),a[72]||(a[72]=s("li",null,[n("这意味着模型对 "),s("strong",null,"训练时没见过的很大位置索引（如 10k+）"),n(" 的泛化能力有限；")],-1)),a[73]||(a[73]=s("li",null,"在长文本时，RoPE 的旋转频率太快，导致信息在高维度上“绕圈绕得太厉害”，难以匹配；",-1)),a[74]||(a[74]=s("li",null,[n("这限制了 GPT-4 类模型在 "),s("strong",null,"扩展上下文长度"),n(" 时的表现。")],-1))]),a[92]||(a[92]=s("p",null,[s("strong",null,"思想"),n("：“拉伸”低频维度位置旋转频率，让远距离 token 不至于旋转太快。")],-1)),a[93]||(a[93]=s("p",null,[s("code",null,"原始RoPE"),n(" 频率指数序列：")],-1)),s("mjx-container",I,[(l(),t("svg",J,a[75]||(a[75]=[e("",1)]))),a[76]||(a[76]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("msub",null,[s("mi",null,"ω"),s("mi",null,"i")]),s("mo",null,"="),s("msup",null,[s("mn",null,"10000"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mo",null,"−"),s("mn",null,"2"),s("mi",null,"i"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mo",null,"/")]),s("mi",null,"d")])])])],-1))]),a[94]||(a[94]=s("p",null,[s("code",null,"NTK RoPE"),n(" 把它换成了：")],-1)),s("mjx-container",X,[(l(),t("svg",K,a[77]||(a[77]=[e("",1)]))),a[78]||(a[78]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("msub",null,[s("mi",null,"ω"),s("mi",null,"i")]),s("mo",null,"="),s("msup",null,[s("mn",null,"10000"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mo",null,"−"),s("mn",null,"2"),s("mi",null,"i"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mo",null,"/")]),s("mo",{stretchy:"false"},"("),s("mi",null,"d"),s("mo",null,"⋅"),s("mi",null,"α"),s("mo",{stretchy:"false"},")")])])])],-1))]),s("p",null,[a[81]||(a[81]=n("其中 ",-1)),s("mjx-container",U,[(l(),t("svg",$,a[79]||(a[79]=[e("",1)]))),a[80]||(a[80]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"α"),s("mo",null,">"),s("mn",null,"1")])],-1))]),a[82]||(a[82]=n(" 是一个",-1)),a[83]||(a[83]=s("strong",null,"位置频率缩放因子",-1)),a[84]||(a[84]=n("，称为 NTK factor。",-1))]),a[95]||(a[95]=e("",6))])}const o1=o(p,[["render",W]]);export{e1 as __pageData,o1 as default};
