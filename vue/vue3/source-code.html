<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue3.0源码分析 | JavaScript边城</title>
    <meta name="description" content="A VitePress site">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/assets/style.Cs1qV2Tl.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.BJhYMcAO.js"></script>
    <link rel="modulepreload" href="/assets/chunks/theme.BpnXUu-e.js">
    <link rel="modulepreload" href="/assets/chunks/framework._eNwL97Z.js">
    <link rel="modulepreload" href="/assets/vue_vue3_source-code.md.D5bnbzxp.lean.js">
    <link rel="icon" href="/logo.svg">
    <link rel="icon" href="https://avatars.githubusercontent.com/u/13958395?v=4">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
  </head>
  <body>
    <div id="app"><div class="VPApp" data-v-66aaf361><!--[--><span tabindex="-1" data-v-41ee5c6f></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-41ee5c6f>Skip to content</a><!--]--><!----><!--[--><!--]--><header class="VPNav nav-bar" data-v-66aaf361 data-v-7e6fc192><div class="VPNavBar" data-v-7e6fc192 data-v-d70b65a3><div class="container" data-v-d70b65a3><a class="VPNavBarTitle" href="/" data-v-d70b65a3 data-v-cd01eb9f><!--[--><!--[--><!--[--><!--[--><div class="nav-bar-title" data-v-429880b3><div class="bar-logo" data-v-429880b3><img src="https://avatars.githubusercontent.com/u/13958395?v=4" alt="心水喵论" data-v-429880b3></div><div class="title-text" data-v-429880b3>JavaScript边城</div></div><!--]--><!--]--><!--]--><!--]--></a><div class="content" data-v-d70b65a3><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-d70b65a3 data-v-93035912><span id="main-nav-aria-label" class="visually-hidden" data-v-93035912>Main Navigation</span><!--[--><!--[--><a class="vt-link link VPNavBarMenuLink" href="/" data-v-93035912 data-v-1bf11343><!--[-->首页<!--]--><!----><!----></a><!--]--><!--[--><a class="vt-link link VPNavBarMenuLink active" href="/vue/vue3/source-code.html" data-v-93035912 data-v-1bf11343><!--[-->Vue·周边<!--]--><!----><!----></a><!--]--><!--[--><a class="vt-link link VPNavBarMenuLink" href="/vite/" data-v-93035912 data-v-1bf11343><!--[-->Vite·Press<!--]--><!----><!----></a><!--]--><!--[--><a class="vt-link link VPNavBarMenuLink" href="/node/core/" data-v-93035912 data-v-1bf11343><!--[-->Node·周边<!--]--><!----><!----></a><!--]--><!--[--><a class="vt-link link VPNavBarMenuLink" href="/basic/javascript/" data-v-93035912 data-v-1bf11343><!--[-->Js·Ts<!--]--><!----><!----></a><!--]--><!--[--><a class="vt-link link VPNavBarMenuLink" href="/mac/setting.html" data-v-93035912 data-v-1bf11343><!--[-->Mac·Linux<!--]--><!----><!----></a><!--]--><!--[--><a class="vt-link link VPNavBarMenuLink" href="/aiart/chat-gpt.html" data-v-93035912 data-v-1bf11343><!--[-->AI·文艺<!--]--><!----><!----></a><!--]--><!--[--><a class="vt-link link VPNavBarMenuLink" href="/mathstat/math/number-theory.html" data-v-93035912 data-v-1bf11343><!--[-->数学·统计<!--]--><!----><!----></a><!--]--><!--]--><!----></nav><div class="VPNavBarAppearance appearance" data-v-d70b65a3 data-v-5b1af3f3><button class="vt-switch vt-switch-appearance" type="button" role="switch" aria-label="Toggle dark mode" aria-checked="false" data-v-5b1af3f3><span class="vt-switch-check"><span class="vt-switch-icon"><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-switch-appearance-sun"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-switch-appearance-moon"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="vt-social-links VPNavBarSocialLinks social-links" data-v-d70b65a3 data-v-59ed7a28><!--[--><a class="vt-social-link is-small" href="https://github.com/wswplay/wswplay.github.io" title="github" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-social-link-icon"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="visually-hidden">github</span></a><!--]--></div><div class="vt-flyout VPNavBarExtra extra" data-v-d70b65a3 data-v-696b3a83><button type="button" class="vt-flyout-button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation"><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-flyout-button-icon"><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg><!--]--></button><div class="vt-flyout-menu"><div class="vt-menu"><!----><!--[--><!--[--><div class="vt-menu-group" data-v-696b3a83><div class="vt-menu-item item" data-v-696b3a83><p class="vt-menu-label" data-v-696b3a83>Appearance</p><div class="vt-menu-action action" data-v-696b3a83><button class="vt-switch vt-switch-appearance" type="button" role="switch" aria-label="Toggle dark mode" aria-checked="false" data-v-696b3a83><span class="vt-switch-check"><span class="vt-switch-icon"><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-switch-appearance-sun"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-switch-appearance-moon"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="vt-menu-group" data-v-696b3a83><div class="vt-menu-item item" data-v-696b3a83><div class="vt-social-links social-links" data-v-696b3a83><!--[--><a class="vt-social-link is-small" href="https://github.com/wswplay/wswplay.github.io" title="github" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-social-link-icon"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="visually-hidden">github</span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><button type="button" class="vt-hamburger VPNavBarHamburger hamburger" aria-label="Mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-d70b65a3 data-v-e27ae2fa><span class="vt-hamburger-container"><span class="vt-hamburger-top"></span><span class="vt-hamburger-middle"></span><span class="vt-hamburger-bottom"></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-66aaf361 data-v-17af4d12><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-17af4d12><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-17af4d12><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-17af4d12>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vt-vh:0px;" data-v-17af4d12 data-v-bf487e00><button class="" data-v-bf487e00>本页目录 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-bf487e00><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></button><!----></div></div><aside class="VPSidebar" data-v-66aaf361 data-v-c52861ec><nav id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-c52861ec><!--[--><!--]--><span id="sidebar-aria-label" class="visually-hidden" data-v-c52861ec>Sidebar Navigation</span><!--[--><div class="group" data-v-c52861ec><section class="VPSidebarGroup" data-v-c52861ec data-v-1d117664><div class="title" data-v-1d117664><h2 class="active title-text" data-v-1d117664>Vue3.x系列集锦<!----></h2></div><!--[--><a class="link" href="/vue/vue3/source-code.html" data-v-1d117664 data-v-683aeeb6><p class="link-text" data-v-683aeeb6>Core流程源码摘要<!----></p></a><a class="link" href="/vue/vue3/reactive.html" data-v-1d117664 data-v-683aeeb6><p class="link-text" data-v-683aeeb6>Reactive响应式系统<!----></p></a><a class="link" href="/vue/vue3/router-code.html" data-v-1d117664 data-v-683aeeb6><p class="link-text" data-v-683aeeb6>Router源码摘要<!----></p></a><a class="link" href="/vue/vue3/pinia-code.html" data-v-1d117664 data-v-683aeeb6><p class="link-text" data-v-683aeeb6>Pinia源码摘要<!----></p></a><!--]--></section></div><div class="group" data-v-c52861ec><section class="VPSidebarGroup" data-v-c52861ec data-v-1d117664><div class="title" data-v-1d117664><h2 class="title-text" data-v-1d117664>Vue2原理<!----></h2></div><!--[--><a class="link" href="/vue/vue2/defineProperty.html" data-v-1d117664 data-v-683aeeb6><p class="link-text" data-v-683aeeb6>DefineProperty<!----></p></a><!--]--></section></div><!--]--><!--[--><!--]--></nav></aside><div id="VPContent" class="VPContent has-sidebar" data-v-66aaf361 data-v-caffc240><div class="VPContentDoc has-aside has-sidebar" data-v-caffc240 data-v-c9771c35><div class="container" data-v-c9771c35><div class="aside" data-v-c9771c35><div class="aside-container" data-v-c9771c35><!--[--><!--]--><div class="VPContentDocOutline" data-v-c9771c35 data-v-b24b265a><div class="outline-marker" data-v-b24b265a></div><div class="outline-title" data-v-b24b265a>本页目录</div><nav aria-labelledby="doc-outline-aria-label" data-v-b24b265a><span id="doc-outline-aria-label" class="visually-hidden" data-v-b24b265a>Table of Contents for current page</span><ul class="root" data-v-b24b265a data-v-ef8882f0><!--[--><li data-v-ef8882f0><a class="outline-link" href="#主流程函数谱系集锦" style="" data-v-ef8882f0>主流程函数谱系集锦</a><ul class="nested" data-v-ef8882f0 data-v-ef8882f0><!--[--><li data-v-ef8882f0><a class="outline-link" href="#创建-app-createapp" style="" data-v-ef8882f0>创建 app：createApp()</a><!----></li><li data-v-ef8882f0><a class="outline-link" href="#渲染-or-更新-patch" style="" data-v-ef8882f0>渲染 or 更新：patch()</a><!----></li><li data-v-ef8882f0><a class="outline-link" href="#模板编译-compile-静态提升" style="" data-v-ef8882f0>模板编译 compile 静态提升</a><!----></li><li data-v-ef8882f0><a class="outline-link" href="#处理选项式-vue2-0-配置-applyoptions" style="" data-v-ef8882f0>处理选项式(Vue2.0)配置 applyOptions</a><!----></li><li data-v-ef8882f0><a class="outline-link" href="#响应式机制-class-reactiveeffect" style="" data-v-ef8882f0>响应式机制 class ReactiveEffect</a><!----></li><!--]--></ul></li><li data-v-ef8882f0><a class="outline-link" href="#插件安装-app-use" style="" data-v-ef8882f0>插件安装 app.use</a><!----></li><li data-v-ef8882f0><a class="outline-link" href="#组件全局注册-app-component" style="" data-v-ef8882f0>组件全局注册 app.component</a><!----></li><li data-v-ef8882f0><a class="outline-link" href="#辅助信息集锦" style="" data-v-ef8882f0>辅助信息集锦</a><ul class="nested" data-v-ef8882f0 data-v-ef8882f0><!--[--><li data-v-ef8882f0><a class="outline-link" href="#枚举-vnode-类型标识-位运算" style="" data-v-ef8882f0>枚举 vnode 类型标识（位运算）</a><!----></li><!--]--></ul></li><!--]--></ul></nav></div><!--[--><!--[--><!--[--><div class="poetry" data-v-5b0a57b7>给每一条河每一座山取一个温暖的名字，我有一所房子，面朝大海，春暖花开。</div><!--]--><!--]--><!--]--><!----><!--[--><!--]--></div></div><div class="content" data-v-c9771c35><!--[--><!--]--><main data-v-c9771c35><div style="position:relative;" class="vt-doc vue" data-v-c9771c35><div><h1 id="vue3-0-流程源码摘要" tabindex="-1">Vue3.0 流程源码摘要 <a class="header-anchor" href="#vue3-0-流程源码摘要" aria-label="Permalink to &quot;Vue3.0 流程源码摘要&quot;">​</a></h1><p><strong>mount</strong>: <code>初次渲染</code>流程函数名：</p><blockquote><p><code>createApp</code> =&gt; <code>app.mount</code> =&gt; <code>mount</code> =&gt; <code>render</code> =&gt; <code>patch</code> =&gt; <code>processComponent</code> =&gt; <code>mountComponent</code> =&gt; <code>createComponentInstance</code> =&gt; <code>setupComponent</code> =&gt; <code>setupRenderEffect</code> =&gt; <code>instance.update</code> =&gt; 【<strong>run</strong>】 =&gt; <code>componentUpdateFn</code> =&gt; (<strong>subTree</strong> = <code>renderComponentRoot</code>) =&gt; <code>render</code> =&gt; <code>createGetter</code>【<strong>收集依赖</strong> <code>track</code> =&gt; <code>trackEffects</code>】 =&gt; <code>patch</code> =&gt; <code>processElement</code> =&gt; <code>mountElement</code> =&gt; <code>hostCreateElement</code> =&gt; <code>hostSetElementText/mountChildren</code> =&gt; <code>setElementText/patch</code> =&gt; <code>hostInsert</code> =&gt; <strong>Done</strong></p></blockquote><p><strong>patch</strong>: <code>更新(diff)</code>流程函数名：例在 <code>mounted</code> 中改变数据</p><blockquote><p><strong>mounted</strong> =&gt; <code>createSetter</code>【<strong>触发更新</strong> <code>trigger</code> =&gt; <code>triggerEffects</code> =&gt; <code>triggerEffect</code>】 =&gt; <code>effect.scheduler/effect.run</code> =&gt; 【<strong>run</strong>】 =&gt; <code>componentUpdateFn</code> =&gt; (<strong>nextTree</strong> = <code> renderComponentRoot</code>) =&gt; <code>render</code> =&gt; <code>patch</code> =&gt; <code>processElement</code> =&gt; <code>patchElement</code> =&gt; <code>patchBlockChildren</code> =&gt; <code>patch</code> =&gt; <code>processComponent</code> =&gt; <code>updateComponent</code> =&gt; <code>shouldUpdateComponent</code> =&gt; <code>instance.update</code> =&gt; 渲染。。。</p></blockquote><h2 id="主流程函数谱系集锦" tabindex="-1">主流程函数谱系集锦 <a class="header-anchor" href="#主流程函数谱系集锦" aria-label="Permalink to &quot;主流程函数谱系集锦&quot;">​</a></h2><h3 id="创建-app-createapp" tabindex="-1">创建 app：createApp() <a class="header-anchor" href="#创建-app-createapp" aria-label="Permalink to &quot;创建 app：createApp()&quot;">​</a></h3><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">createApp</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">args) {</span></span>
<span class="line"><span style="color:#6A737D;">  // 创建app实例</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> app</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> ensureRenderer</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    return renderer || renderer </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> createRenderer</span><span style="color:#E1E4E8;">(rendererOptions) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      return </span><span style="color:#B392F0;">baseCreateRenderer</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">options</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#B392F0;"> render</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {}</span></span>
<span class="line"><span style="color:#F97583;">        return</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">          render,</span></span>
<span class="line"><span style="color:#E1E4E8;">          createApp: </span><span style="color:#B392F0;">createAppAPI</span><span style="color:#E1E4E8;">(render, hydrate) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            return function </span><span style="color:#B392F0;">createApp</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">rootComponent</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">rootProps</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">              const</span><span style="color:#79B8FF;"> context</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> createAppContext</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">                return { app, </span><span style="color:#B392F0;">config</span><span style="color:#E1E4E8;">: {}, mixins </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [], </span><span style="color:#B392F0;">components</span><span style="color:#E1E4E8;">: {}, </span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">              }</span></span>
<span class="line"><span style="color:#F97583;">              const</span><span style="color:#79B8FF;"> installedPlugins</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Set</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#F97583;">              let</span><span style="color:#E1E4E8;"> isMounted </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> false</span></span>
<span class="line"><span style="color:#F97583;">              const</span><span style="color:#79B8FF;"> app</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> context.app </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                _uid: uid</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                _component: rootComponent </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> ConcreteComponent</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                _props: rootProps,</span></span>
<span class="line"><span style="color:#E1E4E8;">                version,</span></span>
<span class="line"><span style="color:#B392F0;">                use</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">plugin</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> Plugin</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">...</span><span style="color:#FFAB70;">options</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;"> any</span><span style="color:#E1E4E8;">[]) {},</span></span>
<span class="line"><span style="color:#B392F0;">                mixin</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">mixin</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> ComponentOptions</span><span style="color:#E1E4E8;">) {}</span></span>
<span class="line"><span style="color:#B392F0;">                component</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">name</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;"> string</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">component</span><span style="color:#F97583;">?:</span><span style="color:#B392F0;"> Component</span><span style="color:#E1E4E8;">) {}</span></span>
<span class="line"><span style="color:#B392F0;">                directive</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">name</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;"> string</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">directive</span><span style="color:#F97583;">?:</span><span style="color:#B392F0;"> Directive</span><span style="color:#E1E4E8;">) {}</span></span>
<span class="line"><span style="color:#B392F0;">                mount</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">container</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">false</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">container</span><span style="color:#FFAB70;"> instanceof</span><span style="color:#FFAB70;"> SVGElement</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">                  if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">isMounted) {</span></span>
<span class="line"><span style="color:#F97583;">                    const</span><span style="color:#79B8FF;"> vnode</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> createVNode</span><span style="color:#E1E4E8;">(rootComponent </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> ConcreteComponent</span><span style="color:#E1E4E8;">, rootProps) {}</span></span>
<span class="line"><span style="color:#E1E4E8;">                    createVNode </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> _createVNode</span><span style="color:#E1E4E8;">(type, props, children) {</span></span>
<span class="line"><span style="color:#F97583;">                      const</span><span style="color:#79B8FF;"> shapeFlag</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> isString</span><span style="color:#E1E4E8;">(type) </span><span style="color:#F97583;">?</span><span style="color:#F97583;"> ...</span><span style="color:#F97583;"> :</span><span style="color:#F97583;"> ...</span></span>
<span class="line"><span style="color:#F97583;">                      return</span><span style="color:#B392F0;"> createBaseVNode</span><span style="color:#E1E4E8;">(type, props, children, shapeFlag) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        const vnode </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                          __v_isVNode: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                          __v_skip: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                          type,</span></span>
<span class="line"><span style="color:#E1E4E8;">                          props,</span></span>
<span class="line"><span style="color:#E1E4E8;">                          children,</span></span>
<span class="line"><span style="color:#E1E4E8;">                          shapeFlag,</span></span>
<span class="line"><span style="color:#E1E4E8;">                        }</span></span>
<span class="line"><span style="color:#B392F0;">                        if</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">needFullChildrenNormalization</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#B392F0;">                          normalizeChildren</span><span style="color:#E1E4E8;">(vnode, children)</span></span>
<span class="line"><span style="color:#E1E4E8;">                        }</span></span>
<span class="line"><span style="color:#E1E4E8;">                        return vnode</span></span>
<span class="line"><span style="color:#E1E4E8;">                      }</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }</span></span>
<span class="line"><span style="color:#E1E4E8;">                    vnode.appContext </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> context</span></span>
<span class="line"><span style="color:#F97583;">                    if</span><span style="color:#E1E4E8;"> (isHydrate </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> hydrate) {</span></span>
<span class="line"><span style="color:#6A737D;">                      // sth</span></span>
<span class="line"><span style="color:#E1E4E8;">                    } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#B392F0;">                      render</span><span style="color:#E1E4E8;">(vnode, rootContainer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> container, isSVG) {</span></span>
<span class="line"><span style="color:#F97583;">                        if</span><span style="color:#E1E4E8;"> (vnode </span><span style="color:#F97583;">==</span><span style="color:#79B8FF;"> null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">                          if</span><span style="color:#E1E4E8;"> (container._vnode) {</span></span>
<span class="line"><span style="color:#B392F0;">                            unmount</span><span style="color:#E1E4E8;">(container._vnode, </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">                          }</span></span>
<span class="line"><span style="color:#E1E4E8;">                        } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#6A737D;">                          // 详情见下面的 patch 函数</span></span>
<span class="line"><span style="color:#B392F0;">                          patch</span><span style="color:#E1E4E8;">(container._vnode </span><span style="color:#F97583;">||</span><span style="color:#79B8FF;"> null</span><span style="color:#E1E4E8;">, vnode, container, </span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">                        }</span></span>
<span class="line"><span style="color:#B392F0;">                        flushPreFlushCbs</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#B392F0;">                        flushPostFlushCbs</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">                        container._vnode </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> vnode</span></span>
<span class="line"><span style="color:#E1E4E8;">                      }</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }</span></span>
<span class="line"><span style="color:#E1E4E8;">                    isMounted </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> true</span></span>
<span class="line"><span style="color:#E1E4E8;">                    app._container </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> rootContainer</span></span>
<span class="line"><span style="color:#E1E4E8;">                  }</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#B392F0;">                unmount</span><span style="color:#E1E4E8;">() {},</span></span>
<span class="line"><span style="color:#B392F0;">                provide</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">key</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">value</span><span style="color:#E1E4E8;">) {}</span></span>
<span class="line"><span style="color:#E1E4E8;">              }</span></span>
<span class="line"><span style="color:#F97583;">              return</span><span style="color:#E1E4E8;"> app</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">          }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }.</span><span style="color:#B392F0;">createApp</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">args)</span></span>
<span class="line"><span style="color:#6A737D;">  // 缓存mount源函数</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">mount</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> app</span></span>
<span class="line"><span style="color:#6A737D;">  // 重写mount函数</span></span>
<span class="line"><span style="color:#E1E4E8;">  app.</span><span style="color:#B392F0;">mount</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">containerOrSelector</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> Element</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> ShadowRoot</span><span style="color:#F97583;"> |</span><span style="color:#79B8FF;"> string</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;"> any</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#6A737D;">    // 容器规范化</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> container</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> normalizeContainer</span><span style="color:#E1E4E8;">(containerOrSelector)</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> component</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> app._component</span></span>
<span class="line"><span style="color:#6A737D;">    // 打扫清空容器内容</span></span>
<span class="line"><span style="color:#E1E4E8;">    container.innerHTML </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;&#39;</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> proxy</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> mount</span><span style="color:#E1E4E8;">(container, </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">, container </span><span style="color:#F97583;">instanceof</span><span style="color:#B392F0;"> SVGElement</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">    return</span><span style="color:#E1E4E8;"> proxy</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#E1E4E8;"> app</span></span>
<span class="line"><span style="color:#E1E4E8;">}.</span><span style="color:#B392F0;">mount</span><span style="color:#E1E4E8;">(container)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br></div></div><h3 id="渲染-or-更新-patch" tabindex="-1">渲染 or 更新：patch() <a class="header-anchor" href="#渲染-or-更新-patch" aria-label="Permalink to &quot;渲染 or 更新：patch()&quot;">​</a></h3><p><code>mountComponent</code> 挂载组件 3 件事：</p><ol><li>创建组件实例；</li><li>执行、设置组件配置；</li><li>创建响应式更新机制；</li></ol><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">patch</span><span style="color:#E1E4E8;">(container._vnode </span><span style="color:#F97583;">||</span><span style="color:#79B8FF;"> null</span><span style="color:#E1E4E8;">, vnode, container, </span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#6A737D;">  // patch(n1, n2, container)</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">type</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">ref</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">shapeFlag</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> n2</span></span>
<span class="line"><span style="color:#F97583;">  switch</span><span style="color:#E1E4E8;"> (type) {</span></span>
<span class="line"><span style="color:#F97583;">    case</span><span style="color:#E1E4E8;"> Text:</span></span>
<span class="line"><span style="color:#B392F0;">      processText</span><span style="color:#E1E4E8;">(n1, n2, container, anchor) {</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (n1 </span><span style="color:#F97583;">==</span><span style="color:#79B8FF;"> null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#B392F0;">          hostInsert</span><span style="color:#E1E4E8;">((n2.el </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> hostCreateText</span><span style="color:#E1E4E8;">(n2.children </span><span style="color:#F97583;">as</span><span style="color:#79B8FF;"> string</span><span style="color:#E1E4E8;">)), container, anchor)</span></span>
<span class="line"><span style="color:#E1E4E8;">        } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">          const</span><span style="color:#79B8FF;"> el</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (n2.el </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> n1.el</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">          if</span><span style="color:#E1E4E8;"> (n2.children </span><span style="color:#F97583;">!==</span><span style="color:#E1E4E8;"> n1.children) {</span></span>
<span class="line"><span style="color:#B392F0;">            hostSetText</span><span style="color:#E1E4E8;">(el, n2.children </span><span style="color:#F97583;">as</span><span style="color:#79B8FF;"> string</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">          }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#F97583;">      break</span></span>
<span class="line"><span style="color:#F97583;">    ...</span></span>
<span class="line"><span style="color:#F97583;">    default</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#F97583;">      if</span><span style="color:#E1E4E8;"> (shapeFlag </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;"> ShapeFlags.</span><span style="color:#79B8FF;">ELEMENT</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#B392F0;">        processElement</span><span style="color:#E1E4E8;">(n1, n2, container) {</span></span>
<span class="line"><span style="color:#6A737D;">          // 挂载元素</span></span>
<span class="line"><span style="color:#F97583;">          if</span><span style="color:#E1E4E8;"> (n1 </span><span style="color:#F97583;">==</span><span style="color:#79B8FF;"> null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#B392F0;">            mountElement</span><span style="color:#E1E4E8;">(n2, container) {</span></span>
<span class="line"><span style="color:#6A737D;">              // mountElement(vnode, container)</span></span>
<span class="line"><span style="color:#F97583;">              let</span><span style="color:#E1E4E8;"> el</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> RendererElement</span></span>
<span class="line"><span style="color:#F97583;">              const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">type</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">props</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">shapeFlag</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">transition</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">dirs</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> vnode</span></span>
<span class="line"><span style="color:#E1E4E8;">              el </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> vnode.el </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> hostCreateElement</span><span style="color:#E1E4E8;">(vnode.type </span><span style="color:#F97583;">as</span><span style="color:#79B8FF;"> string</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">              if</span><span style="color:#E1E4E8;"> (shapeFlag </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;"> ShapeFlags.</span><span style="color:#79B8FF;">TEXT_CHILDREN</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#B392F0;">                hostSetElementText</span><span style="color:#E1E4E8;">(el, vnode.children </span><span style="color:#F97583;">as</span><span style="color:#79B8FF;"> string</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">              } </span><span style="color:#F97583;">else</span><span style="color:#F97583;"> if</span><span style="color:#E1E4E8;"> (shapeFlag </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;"> ShapeFlags.</span><span style="color:#79B8FF;">ARRAY_CHILDREN</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#B392F0;">                mountChildren</span><span style="color:#E1E4E8;">(vnode.children, el, optimized) {</span></span>
<span class="line"><span style="color:#6A737D;">                  // mountChildren(children, container, optimized)</span></span>
<span class="line"><span style="color:#F97583;">                  for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> start; i </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> children.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">; i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">                    const</span><span style="color:#79B8FF;"> child</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (children[i] </span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">                      optimized </span><span style="color:#F97583;">?</span><span style="color:#B392F0;"> cloneIfMounted</span><span style="color:#E1E4E8;">(children[i]) </span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> normalizeVNode</span><span style="color:#E1E4E8;">(children[i]))</span></span>
<span class="line"><span style="color:#B392F0;">                    patch</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, child, container)</span></span>
<span class="line"><span style="color:#E1E4E8;">                  }</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">              }</span></span>
<span class="line"><span style="color:#B392F0;">              hostInsert</span><span style="color:#E1E4E8;">(el, container)</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">          } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#6A737D;">            // 更新元素</span></span>
<span class="line"><span style="color:#B392F0;">            patchElement</span><span style="color:#E1E4E8;">(n1, n2) {</span></span>
<span class="line"><span style="color:#F97583;">              const</span><span style="color:#79B8FF;"> el</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (n2.el </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> n1.el</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">              let</span><span style="color:#E1E4E8;"> { patchFlag, dynamicChildren, dirs } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> n2</span></span>
<span class="line"><span style="color:#F97583;">              if</span><span style="color:#E1E4E8;"> (dynamicChildren) {</span></span>
<span class="line"><span style="color:#B392F0;">                patchBlockChildren</span><span style="color:#E1E4E8;">(n1.dynamicChildren</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">, dynamicChildren, el) {</span></span>
<span class="line"><span style="color:#6A737D;">                  // n1.dynamicChildren!,dynamicChildren =&gt; oldChildren,newChildren</span></span>
<span class="line"><span style="color:#F97583;">                  for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">; i </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> newChildren.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">; i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">                    const</span><span style="color:#79B8FF;"> oldVNode</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> oldChildren[i]</span></span>
<span class="line"><span style="color:#F97583;">                    const</span><span style="color:#79B8FF;"> newVNode</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> newChildren[i]</span></span>
<span class="line"><span style="color:#F97583;">                    ...</span></span>
<span class="line"><span style="color:#E1E4E8;">                  }</span></span>
<span class="line"><span style="color:#B392F0;">                  patch</span><span style="color:#E1E4E8;">(oldVNode, newVNode, container)</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">              } </span><span style="color:#F97583;">else</span><span style="color:#F97583;"> if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">optimized) {</span></span>
<span class="line"><span style="color:#6A737D;">                // 全量 diff</span></span>
<span class="line"><span style="color:#B392F0;">                patchChildren</span><span style="color:#E1E4E8;">(n1, n2, el)</span></span>
<span class="line"><span style="color:#E1E4E8;">              }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">          }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">      } </span><span style="color:#F97583;">else</span><span style="color:#F97583;"> if</span><span style="color:#E1E4E8;">(shapeFlag </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;"> ShapeFlags.</span><span style="color:#79B8FF;">COMPONENT</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#B392F0;">        processComponent</span><span style="color:#E1E4E8;">(n1, n2, container) {</span></span>
<span class="line"><span style="color:#F97583;">          if</span><span style="color:#E1E4E8;"> (n1 </span><span style="color:#F97583;">==</span><span style="color:#79B8FF;"> null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#6A737D;">            // 初次-挂载组件</span></span>
<span class="line"><span style="color:#B392F0;">            mountComponent</span><span style="color:#E1E4E8;">(n2, container) {</span></span>
<span class="line"><span style="color:#6A737D;">              // mountComponent(initialVNode, container)</span></span>
<span class="line"><span style="color:#6A737D;">              // 创建组件实例</span></span>
<span class="line"><span style="color:#F97583;">              const</span><span style="color:#79B8FF;"> instance</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> initialVNode.component </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> createComponentInstance</span><span style="color:#E1E4E8;">(initialVNode) {</span></span>
<span class="line"><span style="color:#6A737D;">                // createComponentInstance(vnode, parent)</span></span>
<span class="line"><span style="color:#E1E4E8;">                const type </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> vnode.type</span></span>
<span class="line"><span style="color:#E1E4E8;">                const instance </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                  uid: uid</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                  vnode,</span></span>
<span class="line"><span style="color:#E1E4E8;">                  type,</span></span>
<span class="line"><span style="color:#E1E4E8;">                  parent,</span></span>
<span class="line"><span style="color:#E1E4E8;">                  isMounted: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#B392F0;">                if</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">__DEV__</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                  instance.ctx </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> createDevRenderContext</span><span style="color:#E1E4E8;">(instance)</span></span>
<span class="line"><span style="color:#E1E4E8;">                } else {</span></span>
<span class="line"><span style="color:#E1E4E8;">                  instance.ctx </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> { _: instance }</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">                instance.root </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> parent </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> parent.root </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> instance</span></span>
<span class="line"><span style="color:#E1E4E8;">                instance.emit </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> emit.</span><span style="color:#B392F0;">bind</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, instance)</span></span>
<span class="line"><span style="color:#E1E4E8;">                return instance</span></span>
<span class="line"><span style="color:#E1E4E8;">              }</span></span>
<span class="line"><span style="color:#6A737D;">              // 执行组件配置</span></span>
<span class="line"><span style="color:#B392F0;">              setupComponent</span><span style="color:#E1E4E8;">(instance) {</span></span>
<span class="line"><span style="color:#F97583;">                const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">props</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">children</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> instance.vnode</span></span>
<span class="line"><span style="color:#F97583;">                const</span><span style="color:#79B8FF;"> isStateful</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> isStatefulComponent</span><span style="color:#E1E4E8;">(instance)</span></span>
<span class="line"><span style="color:#B392F0;">                initProps</span><span style="color:#E1E4E8;">(instance, props, isStateful, isSSR)</span></span>
<span class="line"><span style="color:#B392F0;">                initSlots</span><span style="color:#E1E4E8;">(instance, children)</span></span>
<span class="line"><span style="color:#F97583;">                const</span><span style="color:#79B8FF;"> setupResult</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> isStateful </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#B392F0;"> setupStatefulComponent</span><span style="color:#E1E4E8;">(instance, isSSR) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                  const Component </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> instance.type </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> ComponentOptions</span></span>
<span class="line"><span style="color:#E1E4E8;">                  const { setup } = Component</span></span>
<span class="line"><span style="color:#B392F0;">                  if</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">setup</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">                    const</span><span style="color:#79B8FF;"> setupContext</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> createSetupContext</span><span style="color:#E1E4E8;">(instance)</span></span>
<span class="line"><span style="color:#B392F0;">                    setCurrentInstance</span><span style="color:#E1E4E8;">(instance)</span></span>
<span class="line"><span style="color:#F97583;">                    const</span><span style="color:#79B8FF;"> setupResult</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> callWithErrorHandling</span><span style="color:#E1E4E8;">(setup, </span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">)</span></span>
<span class="line highlighted"><span style="color:#F97583;">                    if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">isPromise</span><span style="color:#E1E4E8;">(setupResult)) {</span></span>
<span class="line"><span style="color:#6A737D;">                      // sth</span></span>
<span class="line"><span style="color:#E1E4E8;">                    } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#B392F0;">                      handleSetupResult</span><span style="color:#E1E4E8;">(instance, setupResult, isSSR) {</span></span>
<span class="line"><span style="color:#6A737D;">                        // 如果setup返回值为函数，它就是组件render函数</span></span>
<span class="line"><span style="color:#F97583;">                        if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">isFunction</span><span style="color:#E1E4E8;">(setupResult)) {</span></span>
<span class="line"><span style="color:#F97583;">                          if</span><span style="color:#E1E4E8;"> (__SSR__ </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#F97583;"> ...</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                            instance.ssrRender </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> setupResult</span></span>
<span class="line"><span style="color:#E1E4E8;">                          } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                            instance.render </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> setupResult </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> InternalRenderFunction</span></span>
<span class="line"><span style="color:#E1E4E8;">                          }</span></span>
<span class="line"><span style="color:#E1E4E8;">                        } </span><span style="color:#F97583;">else</span><span style="color:#F97583;"> if</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">isObject</span><span style="color:#E1E4E8;">(setupResult)) {</span></span>
<span class="line"><span style="color:#6A737D;">                          // 将setup返回值结果添加到组件实例上</span></span>
<span class="line"><span style="color:#E1E4E8;">                          instance.setupState </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> proxyRefs</span><span style="color:#E1E4E8;">(setupResult)</span></span>
<span class="line"><span style="color:#E1E4E8;">                        } </span><span style="color:#F97583;">else</span><span style="color:#F97583;"> if</span><span style="color:#E1E4E8;">() {}</span></span>
<span class="line"><span style="color:#B392F0;">                        finishComponentSetup</span><span style="color:#E1E4E8;">(instance, isSSR)</span></span>
<span class="line"><span style="color:#E1E4E8;">                      }</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }</span></span>
<span class="line"><span style="color:#E1E4E8;">                  } else {</span></span>
<span class="line"><span style="color:#B392F0;">                    finishComponentSetup</span><span style="color:#E1E4E8;">(instance, isSSR) {</span></span>
<span class="line"><span style="color:#F97583;">                      const</span><span style="color:#79B8FF;"> Component</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> instance.type </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> ComponentOptions</span></span>
<span class="line"><span style="color:#F97583;">                      if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">instance.render) {</span></span>
<span class="line"><span style="color:#F97583;">                        if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">isSSR </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> compile </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#F97583;"> !</span><span style="color:#E1E4E8;">Component.render) {</span></span>
<span class="line"><span style="color:#F97583;">                          const</span><span style="color:#79B8FF;"> template</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> xxx</span></span>
<span class="line"><span style="color:#F97583;">                          const</span><span style="color:#79B8FF;"> finalCompilerOption</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> xxx</span></span>
<span class="line"><span style="color:#6A737D;">                          // 将模板编译生成render函数，即 compileToFunction</span></span>
<span class="line"><span style="color:#E1E4E8;">                          Component.render </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> compile</span><span style="color:#E1E4E8;">(template, finalCompilerOptions)</span></span>
<span class="line"><span style="color:#E1E4E8;">                        }</span></span>
<span class="line"><span style="color:#E1E4E8;">                        instance.render </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (Component.render </span><span style="color:#F97583;">||</span><span style="color:#79B8FF;"> NOOP</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> InternalRenderFunction</span></span>
<span class="line"><span style="color:#E1E4E8;">                      }</span></span>
<span class="line"><span style="color:#6A737D;">                      // support for 2.x options 设置vue2选项式api</span></span>
<span class="line"><span style="color:#F97583;">                      if</span><span style="color:#E1E4E8;"> (__FEATURE_OPTIONS_API__ </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#F97583;"> !</span><span style="color:#E1E4E8;">(__COMPAT__ </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> skipOptions)) {</span></span>
<span class="line"><span style="color:#B392F0;">                        setCurrentInstance</span><span style="color:#E1E4E8;">(instance)</span></span>
<span class="line"><span style="color:#B392F0;">                        pauseTracking</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#6A737D;">                        // 详见 applyOptions 章节</span></span>
<span class="line"><span style="color:#B392F0;">                        applyOptions</span><span style="color:#E1E4E8;">(instance)</span></span>
<span class="line"><span style="color:#B392F0;">                        resetTracking</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#B392F0;">                        unsetCurrentInstance</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">                      }</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }</span></span>
<span class="line"><span style="color:#E1E4E8;">                  }</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#F97583;">                return</span><span style="color:#E1E4E8;"> setupResult</span></span>
<span class="line"><span style="color:#E1E4E8;">              }</span></span>
<span class="line"><span style="color:#6A737D;">              // 设置响应式渲染机制</span></span>
<span class="line"><span style="color:#B392F0;">              setupRenderEffect</span><span style="color:#E1E4E8;">(instance, initialVNode, container) {</span></span>
<span class="line"><span style="color:#F97583;">                const</span><span style="color:#B392F0;"> componentUpdateFn</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">                  if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">instance.isMounted) {</span></span>
<span class="line"><span style="color:#6A737D;">                    // beforeMount 钩子</span></span>
<span class="line"><span style="color:#F97583;">                    if</span><span style="color:#E1E4E8;"> (bm) </span><span style="color:#B392F0;">invokeArrayFns</span><span style="color:#E1E4E8;">(bm)</span></span>
<span class="line"><span style="color:#F97583;">                    if</span><span style="color:#E1E4E8;"> (el </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> hydrateNode) {</span></span>
<span class="line"><span style="color:#6A737D;">                      // sth</span></span>
<span class="line"><span style="color:#E1E4E8;">                    } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#6A737D;">                      // 构建子vnode</span></span>
<span class="line"><span style="color:#F97583;">                      const</span><span style="color:#79B8FF;"> subTree</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (instance.subTree </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> renderComponentRoot</span><span style="color:#E1E4E8;">(instance)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        const { </span><span style="color:#B392F0;">type</span><span style="color:#E1E4E8;">: Component, vnode, render } = instance</span></span>
<span class="line"><span style="color:#E1E4E8;">                        let result</span></span>
<span class="line"><span style="color:#6A737D;">                        // 设置当前渲染实例</span></span>
<span class="line"><span style="color:#E1E4E8;">                        const prev </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> setCurrentRenderingInstance</span><span style="color:#E1E4E8;">(instance)</span></span>
<span class="line"><span style="color:#E1E4E8;">                        try {</span></span>
<span class="line"><span style="color:#F97583;">                          if</span><span style="color:#E1E4E8;"> (vnode.shapeFlag </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;"> ShapeFlags.</span><span style="color:#79B8FF;">STATEFUL_COMPONENT</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">                            const</span><span style="color:#79B8FF;"> proxyToUse</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> withProxy </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> proxy</span></span>
<span class="line"><span style="color:#E1E4E8;">                            result </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> normalizeVNode</span><span style="color:#E1E4E8;">(render</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">call</span><span style="color:#E1E4E8;">(proxyToUse, </span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">)) {</span></span>
<span class="line"><span style="color:#6A737D;">                              // normalizeVNode(child: VNodeChild)</span></span>
<span class="line"><span style="color:#F97583;">                              if</span><span style="color:#E1E4E8;"> (child </span><span style="color:#F97583;">==</span><span style="color:#79B8FF;"> null</span><span style="color:#F97583;"> ||</span><span style="color:#F97583;"> typeof</span><span style="color:#E1E4E8;"> child </span><span style="color:#F97583;">===</span><span style="color:#9ECBFF;"> &#39;boolean&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#6A737D;">                                // empty placeholder</span></span>
<span class="line"><span style="color:#F97583;">                                return</span><span style="color:#B392F0;"> createVNode</span><span style="color:#E1E4E8;">(Comment)</span></span>
<span class="line"><span style="color:#E1E4E8;">                              } </span><span style="color:#F97583;">else</span><span style="color:#F97583;"> if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">isArray</span><span style="color:#E1E4E8;">(child)) {</span></span>
<span class="line"><span style="color:#6A737D;">                                // fragment</span></span>
<span class="line"><span style="color:#F97583;">                                return</span><span style="color:#B392F0;"> createVNode</span><span style="color:#E1E4E8;">(Fragment, </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, child.</span><span style="color:#B392F0;">slice</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">                                )</span></span>
<span class="line"><span style="color:#E1E4E8;">                              } </span><span style="color:#F97583;">else</span><span style="color:#F97583;"> if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">typeof</span><span style="color:#E1E4E8;"> child </span><span style="color:#F97583;">===</span><span style="color:#9ECBFF;"> &#39;object&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">                                return</span><span style="color:#B392F0;"> cloneIfMounted</span><span style="color:#E1E4E8;">(child)</span></span>
<span class="line"><span style="color:#E1E4E8;">                              } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#6A737D;">                                // 字符串或数字</span></span>
<span class="line"><span style="color:#F97583;">                                return</span><span style="color:#B392F0;"> createVNode</span><span style="color:#E1E4E8;">(Text, </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">String</span><span style="color:#E1E4E8;">(child))</span></span>
<span class="line"><span style="color:#E1E4E8;">                              }</span></span>
<span class="line"><span style="color:#E1E4E8;">                            }</span></span>
<span class="line"><span style="color:#E1E4E8;">                          } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#6A737D;">                            // functional 函数式组件</span></span>
<span class="line"><span style="color:#E1E4E8;">                          }</span></span>
<span class="line"><span style="color:#E1E4E8;">                        }</span></span>
<span class="line"><span style="color:#B392F0;">                        setCurrentRenderingInstance</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">prev</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">                        return result</span></span>
<span class="line"><span style="color:#E1E4E8;">                      }</span></span>
<span class="line"><span style="color:#B392F0;">                      patch</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, subTree, container)</span></span>
<span class="line"><span style="color:#E1E4E8;">                      initialVNode.el </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> subTree.el</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }</span></span>
<span class="line"><span style="color:#6A737D;">                    // 执行 mounted 钩子</span></span>
<span class="line"><span style="color:#F97583;">                    if</span><span style="color:#E1E4E8;">(m) </span><span style="color:#B392F0;">queuePostRenderEffect</span><span style="color:#E1E4E8;">(m, parentSuspense)</span></span>
<span class="line"><span style="color:#6A737D;">                    // 标记实例为已挂载</span></span>
<span class="line"><span style="color:#E1E4E8;">                    instance.isMounted </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> true</span></span>
<span class="line"><span style="color:#E1E4E8;">                  } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                  }</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#6A737D;">                // 为渲染器创建响应式效应</span></span>
<span class="line"><span style="color:#F97583;">                const</span><span style="color:#79B8FF;"> effect</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (instance.effect </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> ReactiveEffect</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">                  componentUpdateFn,</span></span>
<span class="line"><span style="color:#E1E4E8;">                  () =&gt; </span><span style="color:#B392F0;">queueJob</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">update</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">                  instance.scope</span></span>
<span class="line"><span style="color:#E1E4E8;">                }))</span></span>
<span class="line"><span style="color:#F97583;">                const</span><span style="color:#79B8FF;"> update</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> SchedulerJob</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (instance.</span><span style="color:#B392F0;">update</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> effect.</span><span style="color:#B392F0;">run</span><span style="color:#E1E4E8;">())</span></span>
<span class="line"><span style="color:#E1E4E8;">                update.id </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> instance.uid</span></span>
<span class="line"><span style="color:#B392F0;">                update</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">              }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">          } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#6A737D;">            // 再次-更新组件</span></span>
<span class="line"><span style="color:#B392F0;">            updateComponent</span><span style="color:#E1E4E8;">(n1, n2, optimized) {</span></span>
<span class="line"><span style="color:#F97583;">              const</span><span style="color:#79B8FF;"> instance</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (n2.component </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> n1.component)</span><span style="color:#F97583;">!</span></span>
<span class="line"><span style="color:#6A737D;">              // 如果应该更新组件(如 props 有改变等)</span></span>
<span class="line"><span style="color:#F97583;">              if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">shouldUpdateComponent</span><span style="color:#E1E4E8;">(n1, n2, optimized)) {</span></span>
<span class="line"><span style="color:#F97583;">                if</span><span style="color:#E1E4E8;">(xxx) {</span></span>
<span class="line"><span style="color:#6A737D;">                  // 异步组件</span></span>
<span class="line"><span style="color:#E1E4E8;">                } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                  instance.next </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> n2</span></span>
<span class="line"><span style="color:#B392F0;">                  invalidateJob</span><span style="color:#E1E4E8;">(instance.update)</span></span>
<span class="line"><span style="color:#E1E4E8;">                  instance.</span><span style="color:#B392F0;">update</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">              } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                n2.el </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> n1.el</span></span>
<span class="line"><span style="color:#E1E4E8;">                instance.vnode </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> n2</span></span>
<span class="line"><span style="color:#E1E4E8;">              }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">          }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br></div></div><h3 id="模板编译-compile-静态提升" tabindex="-1">模板编译 compile 静态提升 <a class="header-anchor" href="#模板编译-compile-静态提升" aria-label="Permalink to &quot;模板编译 compile 静态提升&quot;">​</a></h3><p><code>compile</code> 即 <code>compileToFunction</code>。就是将字符串模板，编译转化成 render 函数。</p><ol><li>将模板解析成 ast。</li><li>将通用 ast 转换成 vue 版 ast。标注静态提升。</li><li>生成 render 函数字符串。</li><li>调用 new Function 生成 render 函数。</li></ol><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> compileCache</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> Record</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">RenderFunction</span><span style="color:#E1E4E8;">&gt; </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Object.</span><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> compileToFunction</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#FFAB70;">  template</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;"> string</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> HTMLElement</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#FFAB70;">  options</span><span style="color:#F97583;">?:</span><span style="color:#B392F0;"> CompilerOptions</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> RenderFunction</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> key</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> template</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> cached</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> compileCache[key]</span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (cached) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> cached</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> opts</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> extend</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">code</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> compile</span><span style="color:#E1E4E8;">(template, opts) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    return </span><span style="color:#B392F0;">baseCompile</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">template</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">extend</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">opts</span><span style="color:#E1E4E8;">, ...)) {</span></span>
<span class="line"><span style="color:#6A737D;">      // 解析模板，生成字符串 ast</span></span>
<span class="line"><span style="color:#F97583;">      const</span><span style="color:#79B8FF;"> ast</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> isString</span><span style="color:#E1E4E8;">(template) </span><span style="color:#F97583;">?</span><span style="color:#B392F0;"> baseParse</span><span style="color:#E1E4E8;">(template, options) </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> template</span></span>
<span class="line"><span style="color:#B392F0;">      baseParse</span><span style="color:#E1E4E8;">(template, options) {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> context</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> createParserContext</span><span style="color:#E1E4E8;">(content, options)</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> start</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> getCursor</span><span style="color:#E1E4E8;">(context)</span></span>
<span class="line"><span style="color:#F97583;">        return</span><span style="color:#B392F0;"> createRoot</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#B392F0;">          parseChildren</span><span style="color:#E1E4E8;">(context, TextModes.</span><span style="color:#79B8FF;">DATA</span><span style="color:#E1E4E8;">, []),</span></span>
<span class="line"><span style="color:#B392F0;">          getSelection</span><span style="color:#E1E4E8;">(context, start)</span></span>
<span class="line"><span style="color:#E1E4E8;">        ) {</span></span>
<span class="line"><span style="color:#6A737D;">          // createRoot(children, loc)</span></span>
<span class="line"><span style="color:#E1E4E8;">          return { </span><span style="color:#B392F0;">type</span><span style="color:#E1E4E8;">: NodeTypes.</span><span style="color:#79B8FF;">ROOT</span><span style="color:#E1E4E8;">, children, loc }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#6A737D;">      // 将通用ast 转换(添加一些属性)为 vue-ast</span></span>
<span class="line"><span style="color:#B392F0;">      transform</span><span style="color:#E1E4E8;">(ast, </span><span style="color:#B392F0;">extend</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">)) {</span></span>
<span class="line"><span style="color:#6A737D;">        // transform(root, options)</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> context</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> createTransformContext</span><span style="color:#E1E4E8;">(root, options)</span></span>
<span class="line"><span style="color:#B392F0;">        traverseNode</span><span style="color:#E1E4E8;">(root, context)</span></span>
<span class="line"><span style="color:#6A737D;">        // 静态提升</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (options.hoistStatic) {</span></span>
<span class="line"><span style="color:#B392F0;">          hoistStatic</span><span style="color:#E1E4E8;">(root, context) {</span></span>
<span class="line"><span style="color:#B392F0;">            walk</span><span style="color:#E1E4E8;">(root, context)</span></span>
<span class="line"><span style="color:#E1E4E8;">          }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#6A737D;">      // 生成render函数字符串</span></span>
<span class="line"><span style="color:#F97583;">      return</span><span style="color:#B392F0;"> generate</span><span style="color:#E1E4E8;">(ast, </span><span style="color:#B392F0;">extend</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        const context </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> createCodegenContext</span><span style="color:#E1E4E8;">(ast, options)</span></span>
<span class="line"><span style="color:#E1E4E8;">        return { ast, code, </span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;"> }</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#B392F0;"> render</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">    __GLOBAL__ </span><span style="color:#F97583;">?</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Function</span><span style="color:#E1E4E8;">(code)() </span><span style="color:#F97583;">:</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Function</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;Vue&#39;</span><span style="color:#E1E4E8;">, code)(runtimeDom)</span></span>
<span class="line"><span style="color:#E1E4E8;">  ) </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> RenderFunction</span></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#E1E4E8;"> (compileCache[key] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> render)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h3 id="处理选项式-vue2-0-配置-applyoptions" tabindex="-1">处理选项式(Vue2.0)配置 applyOptions <a class="header-anchor" href="#处理选项式-vue2-0-配置-applyoptions" aria-label="Permalink to &quot;处理选项式(Vue2.0)配置 applyOptions&quot;">​</a></h3><p>就是把各种配置，挂到 instance 实例上。</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">applyOptions</span><span style="color:#E1E4E8;">(instance) {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> options</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> resolveMergedOptions</span><span style="color:#E1E4E8;">(instance)</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> ctx</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> instance.ctx</span></span>
<span class="line"><span style="color:#6A737D;">  // 执行beforeCreate钩子</span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (options.beforeCreate) {</span></span>
<span class="line"><span style="color:#B392F0;">    callHook</span><span style="color:#E1E4E8;">(options.beforeCreate, instance, </span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">created</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> options</span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (injectOptions) { </span><span style="color:#6A737D;">/* 解析、设置inject */</span><span style="color:#E1E4E8;"> }</span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (methods) { </span><span style="color:#6A737D;">/* 方法 */</span><span style="color:#E1E4E8;"> }</span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (dataOptions) { </span><span style="color:#6A737D;">// 解析、设置data</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> data</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> dataOptions.</span><span style="color:#B392F0;">call</span><span style="color:#E1E4E8;">(publicThis, publicThis)</span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#B392F0;">isObject</span><span style="color:#E1E4E8;">(data)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      __DEV__ </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#B392F0;"> warn</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">`data() should return an object.`</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      instance.data </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> reactive</span><span style="color:#E1E4E8;">(data)</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (computedOptions) { </span><span style="color:#6A737D;">/* 解析、设置computed */</span><span style="color:#E1E4E8;"> }</span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (watchOptions) { </span><span style="color:#6A737D;">/* 解析、设置watch */</span><span style="color:#E1E4E8;"> }</span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (provideOptions) { </span><span style="color:#6A737D;">/* 解析、设置provide */</span><span style="color:#E1E4E8;"> }</span></span>
<span class="line"><span style="color:#6A737D;">  // 执行created钩子</span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (created) {</span></span>
<span class="line"><span style="color:#B392F0;">    callHook</span><span style="color:#E1E4E8;">(created, instance, LifecycleHooks.</span><span style="color:#79B8FF;">CREATED</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#6A737D;">  // 注册剩余钩子们</span></span>
<span class="line"><span style="color:#B392F0;">  registerLifecycleHook</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#6A737D;">  // 其他各种特性设置</span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (render </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> instance.render </span><span style="color:#F97583;">===</span><span style="color:#79B8FF;"> NOOP</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    instance.render </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> render </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> InternalRenderFunction</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (inheritAttrs </span><span style="color:#F97583;">!=</span><span style="color:#79B8FF;"> null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    instance.inheritAttrs </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> inheritAttrs</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (components) instance.components </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> components </span><span style="color:#F97583;">as</span><span style="color:#79B8FF;"> any</span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (directives) instance.directives </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> directives</span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">    __COMPAT__ </span><span style="color:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="color:#E1E4E8;">    filters </span><span style="color:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="color:#B392F0;">    isCompatEnabled</span><span style="color:#E1E4E8;">(DeprecationTypes.</span><span style="color:#79B8FF;">FILTERS</span><span style="color:#E1E4E8;">, instance)</span></span>
<span class="line"><span style="color:#E1E4E8;">  ) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    instance.filters </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> filters</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h3 id="响应式机制-class-reactiveeffect" tabindex="-1">响应式机制 class ReactiveEffect <a class="header-anchor" href="#响应式机制-class-reactiveeffect" aria-label="Permalink to &quot;响应式机制 class ReactiveEffect&quot;">​</a></h3><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> let</span><span style="color:#E1E4E8;"> activeEffect</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> ReactiveEffect</span><span style="color:#F97583;"> |</span><span style="color:#79B8FF;"> undefined</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> class</span><span style="color:#B392F0;"> ReactiveEffect</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">T</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> any</span><span style="color:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="color:#FFAB70;">  active</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> true</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#FFAB70;">  deps</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> Dep</span><span style="color:#E1E4E8;">[] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#F97583;">  constructor</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#F97583;">    public</span><span style="color:#B392F0;"> fn</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> T</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#F97583;">    public</span><span style="color:#FFAB70;"> scheduler</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> EffectScheduler</span><span style="color:#F97583;"> |</span><span style="color:#79B8FF;"> null</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> null</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#FFAB70;">    scope</span><span style="color:#F97583;">?:</span><span style="color:#B392F0;"> EffectScope</span></span>
<span class="line"><span style="color:#E1E4E8;">  ) {</span></span>
<span class="line"><span style="color:#B392F0;">    recordEffectScope</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">, scope);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#B392F0;">  run</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.active) </span><span style="color:#F97583;">return</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">fn</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> parent</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> ReactiveEffect</span><span style="color:#F97583;"> |</span><span style="color:#79B8FF;"> undefined</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> activeEffect;</span></span>
<span class="line"><span style="color:#F97583;">    try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#79B8FF;">      this</span><span style="color:#E1E4E8;">.parent </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> activeEffect;</span></span>
<span class="line"><span style="color:#E1E4E8;">      activeEffect </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">      shouldTrack </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> true</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">      return</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">fn</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">finally</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="插件安装-app-use" tabindex="-1">插件安装 app.use <a class="header-anchor" href="#插件安装-app-use" aria-label="Permalink to &quot;插件安装 app.use&quot;">​</a></h2><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> app</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> App</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (context.app </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  _uid: uid</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#B392F0;">  use</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">plugin</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> Plugin</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">...</span><span style="color:#FFAB70;">options</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;"> any</span><span style="color:#E1E4E8;">[]) {</span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (installedPlugins.</span><span style="color:#B392F0;">has</span><span style="color:#E1E4E8;">(plugin)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      __DEV__ </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#B392F0;"> warn</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">`Plugin has already been applied to target app.`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">else</span><span style="color:#F97583;"> if</span><span style="color:#E1E4E8;"> (plugin </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#B392F0;"> isFunction</span><span style="color:#E1E4E8;">(plugin.install)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      installedPlugins.</span><span style="color:#B392F0;">add</span><span style="color:#E1E4E8;">(plugin);</span></span>
<span class="line"><span style="color:#E1E4E8;">      plugin.</span><span style="color:#B392F0;">install</span><span style="color:#E1E4E8;">(app, </span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">options);</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">else</span><span style="color:#F97583;"> if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">isFunction</span><span style="color:#E1E4E8;">(plugin)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      installedPlugins.</span><span style="color:#B392F0;">add</span><span style="color:#E1E4E8;">(plugin);</span></span>
<span class="line"><span style="color:#B392F0;">      plugin</span><span style="color:#E1E4E8;">(app, </span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">options);</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">else</span><span style="color:#F97583;"> if</span><span style="color:#E1E4E8;"> (__DEV__) {</span></span>
<span class="line"><span style="color:#B392F0;">      warn</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#9ECBFF;">        `A plugin must either be a function or an object with an &quot;install&quot; `</span><span style="color:#F97583;"> +</span></span>
<span class="line"><span style="color:#9ECBFF;">          `function.`</span></span>
<span class="line"><span style="color:#E1E4E8;">      );</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#F97583;">    return</span><span style="color:#E1E4E8;"> app;</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="组件全局注册-app-component" tabindex="-1">组件全局注册 app.component <a class="header-anchor" href="#组件全局注册-app-component" aria-label="Permalink to &quot;组件全局注册 app.component&quot;">​</a></h2><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> app</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> App</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (context.app </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  _uid: uid</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#B392F0;">  component</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">name</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;"> string</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">component</span><span style="color:#F97583;">?:</span><span style="color:#B392F0;"> Component</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;"> any</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (__DEV__) {</span></span>
<span class="line"><span style="color:#B392F0;">      validateComponentName</span><span style="color:#E1E4E8;">(name, context.config);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">component) {</span></span>
<span class="line"><span style="color:#F97583;">      return</span><span style="color:#E1E4E8;"> context.components[name];</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (__DEV__ </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> context.components[name]) {</span></span>
<span class="line"><span style="color:#B392F0;">      warn</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">`Component &quot;${</span><span style="color:#E1E4E8;">name</span><span style="color:#9ECBFF;">}&quot; has already been registered in target app.`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    context.components[name] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> component;</span></span>
<span class="line"><span style="color:#F97583;">    return</span><span style="color:#E1E4E8;"> app;</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="辅助信息集锦" tabindex="-1">辅助信息集锦 <a class="header-anchor" href="#辅助信息集锦" aria-label="Permalink to &quot;辅助信息集锦&quot;">​</a></h2><h3 id="枚举-vnode-类型标识-位运算" tabindex="-1">枚举 vnode 类型标识（<a href="/basic/javascript/operators.html">位运算</a>） <a class="header-anchor" href="#枚举-vnode-类型标识-位运算" aria-label="Permalink to &quot;枚举 vnode 类型标识（[位运算](/basic/javascript/operators.html)）&quot;">​</a></h3><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> const</span><span style="color:#F97583;"> enum</span><span style="color:#B392F0;"> ShapeFlags</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#79B8FF;">  ELEMENT</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">  FUNCTIONAL_COMPONENT</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 1</span><span style="color:#F97583;"> &lt;&lt;</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">  STATEFUL_COMPONENT</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 1</span><span style="color:#F97583;"> &lt;&lt;</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">  TEXT_CHILDREN</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 1</span><span style="color:#F97583;"> &lt;&lt;</span><span style="color:#79B8FF;"> 3</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">  ARRAY_CHILDREN</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 1</span><span style="color:#F97583;"> &lt;&lt;</span><span style="color:#79B8FF;"> 4</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">  SLOTS_CHILDREN</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 1</span><span style="color:#F97583;"> &lt;&lt;</span><span style="color:#79B8FF;"> 5</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">  TELEPORT</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 1</span><span style="color:#F97583;"> &lt;&lt;</span><span style="color:#79B8FF;"> 6</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">  SUSPENSE</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 1</span><span style="color:#F97583;"> &lt;&lt;</span><span style="color:#79B8FF;"> 7</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">  COMPONENT_SHOULD_KEEP_ALIVE</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 1</span><span style="color:#F97583;"> &lt;&lt;</span><span style="color:#79B8FF;"> 8</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">  COMPONENT_KEPT_ALIVE</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 1</span><span style="color:#F97583;"> &lt;&lt;</span><span style="color:#79B8FF;"> 9</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">  COMPONENT</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> ShapeFlags.</span><span style="color:#79B8FF;">STATEFUL_COMPONENT</span><span style="color:#F97583;"> |</span><span style="color:#E1E4E8;"> ShapeFlags.</span><span style="color:#79B8FF;">FUNCTIONAL_COMPONENT</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></div></div><!----></main><!--[--><!--]--><footer class="VPContentDocFooter" data-v-c9771c35 data-v-5413c223><!----><a class="next-link" href="/vue/vue3/reactive.html" data-v-5413c223><span class="desc" data-v-5413c223>下一篇 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-link-icon" data-v-5413c223><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></span><span class="title" data-v-5413c223>Reactive响应式系统</span></a></footer></div></div></div></div><div class="visually-hidden" aria-live="polite" data-v-66aaf361>Vue3.0源码分析 has loaded</div></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"aiart_chat-gpt.md\":\"D_AjEP0z\",\"aiart_comfyui_basic.md\":\"wvs4BTKB\",\"aiart_deep-learning_basic-concept.md\":\"aCZrIO_v\",\"aiart_deep-learning_linear-regression.md\":\"CHenO9LX\",\"aiart_deep-learning_mathematics.md\":\"DkcT4N1W\",\"aiart_deep-learning_overview.md\":\"BEkATmAH\",\"aiart_huggingface_accelerate.md\":\"NAYj45Rl\",\"aiart_huggingface_config.md\":\"8Ccnmq6p\",\"aiart_huggingface_diffusers.md\":\"Dstc-3FX\",\"aiart_huggingface_pytorch.md\":\"CtJkazgT\",\"aiart_machine-learning_conda.md\":\"BHjV57wW\",\"aiart_machine-learning_kaggle.md\":\"CqlPytEC\",\"aiart_machine-learning_overview.md\":\"B_nQBnIq\",\"aiart_python_basic-info.md\":\"D3FB6PZ4\",\"aiart_python_oop.md\":\"D3hq_q3Y\",\"aiart_python_pandas.md\":\"BPgU6q3y\",\"aiart_python_pil.md\":\"BDGrusd1\",\"aiart_python_pip.md\":\"C0D7-mD4\",\"aiart_sunzi-war-art.md\":\"DJcvxrK4\",\"basic_javascript_array.md\":\"CSBeCnuV\",\"basic_javascript_bitwise-operators.md\":\"viKVg3CL\",\"basic_javascript_function.md\":\"GI9zvYnj\",\"basic_javascript_index.md\":\"B0tkDH6y\",\"basic_javascript_object.md\":\"CJojbMel\",\"basic_javascript_operators.md\":\"DaYvd2jS\",\"basic_javascript_promise.md\":\"hubFsCC_\",\"basic_javascript_proxy.md\":\"HJMZbDEW\",\"basic_javascript_reflect.md\":\"D4_FU9nW\",\"basic_javascript_symbol.md\":\"Xuj6DE1f\",\"basic_tools_cold-code.md\":\"DWZZK4MJ\",\"basic_tools_markdown.md\":\"Bru_pebV\",\"basic_tools_worker.md\":\"ENEuMZFx\",\"basic_typescript_config-file.md\":\"DMKa7uoL\",\"basic_typescript_declare.md\":\"C0Jo0HK7\",\"basic_typescript_index.md\":\"Co7Igk2U\",\"basic_typescript_tsx.md\":\"Tp9RBIif\",\"index.md\":\"D7Xs3EnG\",\"mac_daily.md\":\"CQ2WQVz6\",\"mac_dev-tools.md\":\"BODSgj13\",\"mac_linux_os-command.md\":\"DXCaIPTI\",\"mac_linux_vim.md\":\"CFwtOTwl\",\"mac_setting.md\":\"C1KVPX_A\",\"mac_vscode.md\":\"87KvseEo\",\"mathstat_math_calculus.md\":\"go9hd_2-\",\"mathstat_math_math-symbol.md\":\"Tf5aAx9p\",\"mathstat_math_number-theory.md\":\"DQSKLiDD\",\"node_core_fs.md\":\"CGkxYZNW\",\"node_core_http.md\":\"C0QsVx7g\",\"node_core_index.md\":\"DeHpTNRY\",\"node_core_path.md\":\"DLFTIxUp\",\"node_core_process.md\":\"-GJxI6kJ\",\"node_core_url.md\":\"BEichTRH\",\"node_external_cli.md\":\"Bmdoyuag\",\"node_external_debug.md\":\"CDEtSMpb\",\"node_external_git.md\":\"BX-X7_Qe\",\"node_external_github.md\":\"iZZvEqll\",\"node_external_npm-run-all.md\":\"DCLm_PL-\",\"node_external_npm.md\":\"BmJ7RRF5\",\"node_external_npx.md\":\"rUf7vhXu\",\"node_external_nvm.md\":\"pH9_ahj3\",\"node_external_package-json.md\":\"C3jzeRk7\",\"node_external_pnpm-monorepo.md\":\"CkKDDucK\",\"node_external_server.md\":\"CdIfxbvf\",\"node_external_websockets.md\":\"quDqJU4q\",\"vite_command-cli.md\":\"LcYeudqq\",\"vite_create-vite.md\":\"DKPTwAJ9\",\"vite_extend_rollup-source-build.md\":\"CG1aJcoF\",\"vite_extend_rollup-source-write.md\":\"D1ufq2-r\",\"vite_index.md\":\"C9DwhD1E\",\"vite_plugin.md\":\"BjcLhQ_1\",\"vite_press_press-command.md\":\"Ch788X_b\",\"vite_press_theme-default.md\":\"d-Gd1b_e\",\"vite_press_theme-vue.md\":\"C_Slhvbn\",\"vite_press_vitepress.md\":\"BwN55Unm\",\"vite_rollup-source.md\":\"CP8Os-ci\",\"vite_rollup.md\":\"pQ9hgj0T\",\"vue_vue2_defineproperty.md\":\"BeXzVSVn\",\"vue_vue3_pinia-code.md\":\"BZrhMgGY\",\"vue_vue3_reactive.md\":\"q6pQL-Hx\",\"vue_vue3_router-code.md\":\"Cq7_XPU7\",\"vue_vue3_source-code.md\":\"D5bnbzxp\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"JavaScript边城\",\"description\":\"A VitePress site\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"Vue·周边\",\"activeMatch\":\"^/vue/\",\"link\":\"/vue/vue3/source-code\"},{\"text\":\"Vite·Press\",\"activeMatch\":\"^/vite/\",\"link\":\"/vite/\"},{\"text\":\"Node·周边\",\"activeMatch\":\"^/node/\",\"link\":\"/node/core/\"},{\"text\":\"Js·Ts\",\"activeMatch\":\"^/basic\",\"link\":\"/basic/javascript/\"},{\"text\":\"Mac·Linux\",\"activeMatch\":\"^/mac\",\"link\":\"/mac/setting\"},{\"text\":\"AI·文艺\",\"activeMatch\":\"^/aiart\",\"link\":\"/aiart/chat-gpt\"},{\"text\":\"数学·统计\",\"activeMatch\":\"^/mathstat\",\"link\":\"/mathstat/math/number-theory\"}],\"sidebar\":{\"/vue/\":[{\"text\":\"Vue3.x系列集锦\",\"items\":[{\"text\":\"Core流程源码摘要\",\"link\":\"/vue/vue3/source-code\"},{\"text\":\"Reactive响应式系统\",\"link\":\"/vue/vue3/reactive\"},{\"text\":\"Router源码摘要\",\"link\":\"/vue/vue3/router-code\"},{\"text\":\"Pinia源码摘要\",\"link\":\"/vue/vue3/pinia-code\"}]},{\"text\":\"Vue2原理\",\"items\":[{\"text\":\"DefineProperty\",\"link\":\"/vue/vue2/defineProperty\"}]}],\"/vite/\":[{\"text\":\"Vite原理与周边\",\"items\":[{\"text\":\"Vite基础\",\"link\":\"/vite/\"},{\"text\":\"vite命令源码摘要\",\"link\":\"/vite/command-cli\"},{\"text\":\"Vite自动生成项目原理\",\"link\":\"/vite/create-vite\"},{\"text\":\"Vite插件怎么写\",\"link\":\"/vite/plugin\"}]},{\"text\":\"Rollup.js\",\"items\":[{\"text\":\"安装命令及配置文件\",\"link\":\"/vite/rollup\"},{\"text\":\"rollup.js源码摘要\",\"link\":\"/vite/rollup-source\"}]},{\"text\":\"Vitepress\",\"items\":[{\"text\":\"简介与功能\",\"link\":\"/vite/press/vitepress\"},{\"text\":\"vitepress命令源码摘要\",\"link\":\"/vite/press/press-command\"},{\"text\":\"默认主题(default)\",\"link\":\"/vite/press/theme-default\"},{\"text\":\"Vue官方主题(Vue3)\",\"link\":\"/vite/press/theme-vue\"}]}],\"/node/\":[{\"text\":\"Node基础\",\"items\":[{\"text\":\"简介\",\"link\":\"/node/core/\"},{\"text\":\"fs文件系统及扩展\",\"link\":\"/node/core/fs\"},{\"text\":\"url模块\",\"link\":\"/node/core/url\"},{\"text\":\"path路径\",\"link\":\"/node/core/path\"},{\"text\":\"http模块\",\"link\":\"/node/core/http\"},{\"text\":\"process进程\",\"link\":\"/node/core/process\"}]},{\"text\":\"周边工具\",\"items\":[{\"text\":\"本地调试Node项目文件\",\"link\":\"/node/external/debug\"},{\"text\":\"写个Node命令行工具\",\"link\":\"/node/external/cli\"},{\"text\":\"npm\",\"link\":\"/node/external/npm\"},{\"text\":\"npx\",\"link\":\"/node/external/npx\"},{\"text\":\"package.json\",\"link\":\"/node/external/package-json\"},{\"text\":\"pnpm monorepo\",\"link\":\"/node/external/pnpm-monorepo\"},{\"text\":\"nvm 和 nrm\",\"link\":\"/node/external/nvm\"},{\"text\":\"git\",\"link\":\"/node/external/git\"},{\"text\":\"Github\",\"link\":\"/node/external/github\"},{\"text\":\"npm-run-all\",\"link\":\"/node/external/npm-run-all\"},{\"text\":\"服务器类型\",\"link\":\"/node/external/server\"},{\"text\":\"WebSocket\",\"link\":\"/node/external/websockets\"}]}],\"/basic/\":[{\"text\":\"JavaScript基础\",\"items\":[{\"text\":\"简介\",\"link\":\"/basic/javascript/\"},{\"text\":\"Array数组\",\"link\":\"/basic/javascript/array\"},{\"text\":\"Object对象\",\"link\":\"/basic/javascript/object\"},{\"text\":\"Function函数\",\"link\":\"/basic/javascript/function\"},{\"text\":\"Symbol标识符\",\"link\":\"/basic/javascript/symbol\"},{\"text\":\"Promise\",\"link\":\"/basic/javascript/promise\"},{\"text\":\"Proxy\",\"link\":\"/basic/javascript/proxy\"},{\"text\":\"Reflect\",\"link\":\"/basic/javascript/reflect\"},{\"text\":\"表达式与运算符\",\"link\":\"/basic/javascript/operators\"},{\"text\":\"位运算\",\"link\":\"/basic/javascript/bitwise-operators\"}]},{\"text\":\"TypeScript基础\",\"items\":[{\"text\":\"基本认知与区别\",\"link\":\"/basic/typescript/\"},{\"text\":\"tsconfig.json字段详解\",\"link\":\"/basic/typescript/config-file\"},{\"text\":\"declare及声明文件\",\"link\":\"/basic/typescript/declare\"},{\"text\":\"tsx执行ts及VSCode调试ts\",\"link\":\"/basic/typescript/tsx\"}]},{\"text\":\"周边及工具\",\"items\":[{\"text\":\"Markdown及生成目录\",\"link\":\"/basic/tools/markdown\"},{\"text\":\"工具函数-冷知识-酷代码\",\"link\":\"/basic/tools/cold-code\"},{\"text\":\"Web Worker\",\"link\":\"/basic/tools/worker\"}]}],\"/mac/\":[{\"text\":\"Mac那点事\",\"items\":[{\"text\":\"基本设置\",\"link\":\"/mac/setting\"},{\"text\":\"日常操作\",\"link\":\"/mac/daily\"},{\"text\":\"工具:brew/iTerm2\",\"link\":\"/mac/dev-tools\"},{\"text\":\"VSCode编辑器\",\"link\":\"/mac/vscode\"}]},{\"text\":\"Linux\",\"items\":[{\"text\":\"基础命令\",\"link\":\"/mac/linux/os-command\"},{\"text\":\"vim编辑器\",\"link\":\"/mac/linux/vim\"}]}],\"/aiart/\":[{\"text\":\"AI\",\"items\":[{\"text\":\"ChatGPT问答集锦\",\"link\":\"/aiart/chat-gpt\"}]},{\"text\":\"机器学习\",\"items\":[{\"text\":\"概览\",\"link\":\"/aiart/machine-learning/overview\"},{\"text\":\"conda\",\"link\":\"/aiart/machine-learning/conda\"},{\"text\":\"kaggle\",\"link\":\"/aiart/machine-learning/kaggle\"}]},{\"text\":\"深度学习\",\"items\":[{\"text\":\"概览\",\"link\":\"/aiart/deep-learning/overview\"},{\"text\":\"数学基础\",\"link\":\"/aiart/deep-learning/mathematics\"},{\"text\":\"基本概念\",\"link\":\"/aiart/deep-learning/basic-concept\"},{\"text\":\"线性回归\",\"link\":\"/aiart/deep-learning/linear-regression\"}]},{\"text\":\"Huggingface\",\"items\":[{\"text\":\"基础配置\",\"link\":\"/aiart/huggingface/config\"},{\"text\":\"Diffusers\",\"link\":\"/aiart/huggingface/diffusers\"},{\"text\":\"Accelerate\",\"link\":\"/aiart/huggingface/accelerate\"},{\"text\":\"Pytorch\",\"link\":\"/aiart/huggingface/pytorch\"}]},{\"text\":\"ComfyUI\",\"items\":[{\"text\":\"基本概念\",\"link\":\"/aiart/comfyui/basic\"}]},{\"text\":\"Python\",\"items\":[{\"text\":\"安装与设置\",\"link\":\"/aiart/python/basic-info\"},{\"text\":\"pip\",\"link\":\"/aiart/python/pip\"},{\"text\":\"面向对象编程(OOP)\",\"link\":\"/aiart/python/oop\"},{\"text\":\"Pandas\",\"link\":\"/aiart/python/pandas\"},{\"text\":\"PIL\",\"link\":\"/aiart/python/pil\"}]},{\"text\":\"文艺\",\"items\":[{\"text\":\"孙子兵法\",\"link\":\"/aiart/sunzi-war-art\"}]}],\"/mathstat\":[{\"text\":\"理论\",\"items\":[{\"text\":\"数的概念\",\"link\":\"/mathstat/math/number-theory\"},{\"text\":\"数学符号\",\"link\":\"/mathstat/math/math-symbol\"}]},{\"text\":\"微积分\",\"items\":[{\"text\":\"基本定理\",\"link\":\"/mathstat/math/calculus\"}]},{\"text\":\"统计学\",\"items\":[]}]},\"i18n\":{\"toc\":\"本页目录\",\"previous\":\"前一篇\",\"next\":\"下一篇\",\"pageNotFound\":\"页面未找到\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/wswplay/wswplay.github.io\"}],\"footer\":{\"copyright\":\"Copyright © 2020-2025 边城\"}},\"locales\":{},\"scrollOffset\":[\"header\",\".VPLocalNav\"],\"cleanUrls\":false}");</script>
    
  </body>
</html>